<!doctype html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>520爱的魔力转圈圈</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/520activity.css?v=4.0">
	<link rel="stylesheet" type="text/css" href="css/popup.css">
	<script type="text/javascript" src="js/fastclick.js"></script>
</head>

<body>
	<div class="wrapper w1">
		<div class="banner w1 mat">
			<img class="openMask" src="img/520activity/tnc@2x.png" alt="">
		</div>
		<div class="actTerm w1">
			<div class="conTitle title"></div>
			<div class="allInfo mat">
				<div class="mainCon clearfix mat">
					<table class="prizeList">
					    <tr>
					        <td class="pao pao-1">
								<img class="pHover" src="img/520activity/b1@2x.png" alt="">
					        </td>
					        <td class="pao pao-2">
					        	<img class="pHover" src="img/520activity/b2@2x.png" alt="">
					        </td>
					        <td class="pao pao-3">
					        	<img class="pHover" src="img/520activity/b3@2x.png" alt="">
					        </td>
					        <td class="pao pao-4">
					        	<img class="pHover" src="img/520activity/b4@2x.png" alt="">
					        </td>
					    </tr>
					    <tr>
					        <td class="pao pao-16">
					        	<img class="pHover" src="img/520activity/b16@2x.png" alt="">
					    	</td>
					        <td class="pao"></td>
					        <td class="pao"></td>
					        <td class="pao pao-5">
					        	<img class="pHover" src="img/520activity/b5@2x.png" alt="">
					        </td>
					    </tr>
					    <tr>
					        <td class="pao pao-15">
					        	<img class="pHover" src="img/520activity/b15@2x.png" alt="">
					        </td>
					        <td class="pao"></td>
					        <td class="pao"></td>
					        <td class="pao pao-6">
					        	<img class="pHover" src="img/520activity/b6@2x.png" alt="">
					        </td>
					    </tr>
					    <tr>
					        <td class="pao pao-14">
					        	<img class="pHover" src="img/520activity/b14@2x.png" alt="">
					        </td>
					        <td class="pao"></td>
					        <td class="pao"></td>
					        <td class="pao pao-7">
					        	<img class="pHover" src="img/520activity/b7@2x.png" alt="">
					        </td>
					    </tr>
					    <tr>
					        <td class="pao pao-13">
					        	<img class="pHover" src="img/520activity/b13@2x.png" alt="">
					    	</td>
					        <td class="pao"></td>
					        <td class="pao"></td>
					        <td class="pao pao-8">
					        	<img class="pHover" src="img/520activity/b8@2x.png" alt="">
					        </td>
					    </tr>
					    <tr>
					        <td class="pao pao-12">
					        	<img class="pHover" src="img/520activity/b12@2x.png" alt="">
					        </td>
					        <td class="pao pao-11">
					        	<img class="pHover" src="img/520activity/b11@2x.png" alt="">
					        </td>
					        <td class="pao pao-10">
					        	<img class="pHover" src="img/520activity/b10@2x.png" alt="">
					        </td>
					        <td class="pao pao-9">
					        	<img class="pHover" src="img/520activity/b9@2x.png" alt="">
					        </td>
					    </tr>
					</table>
					<div class="prizeNum times">0</div>
					<div class="pBtn" id="startPao"></div>
				</div>
			</div>
		</div>

		<div class="mask">
			<img class="closeMask" src="img/520activity/close@2x.png" alt="">
			<div class="conTitle title"></div>
			<div class="conInfo mat">
				<p class="conText mat">
					U赢电竞周年庆将结束于<span class="sp">5月20日</span>，在这即将结束时刻为用户再一次送上<span class="sp">520活动祝福</span>，活动期间用户<span class="sp">单笔充值金额200元</span>即可获得<span class="sp">一次520魔力轮盘抽奖机会。</span>每日最高5次机会，隔日清零。
				</p>
				<img class="topup" src="img/520activity/love.png" alt="">
			</div>
			<div class="ruleTitle title"></div>
			<ul class="termList mat">
				<li>
					<i class="termIndex">1</i>
					<p>
						活动期间用户单笔充值金额200即可获得一次抽奖机会，每日最高5次机会，隔天清零；
					</p>
				</li>
				<li>
					<i class="termIndex">2</i>
					<p>
						抽奖活动中获得奖励，请在中奖后联系平台客服进行领取；
					</p>
				</li>
				<li>
					<i class="termIndex">3</i>
					<p>
						抽奖活动中获得实物奖品、饰品均可8折兑现，兑现金额需要完成一倍流水后提款；
					</p>
				</li>
				<li>
					<i class="termIndex">4</i>
					<p>
						如发现恶意刷取活动套利者，将扣除所得奖励及盈利，并冻结账户；
					</p>
				</li>
				<li>
					<i class="termIndex">5</i>
					<p>
						凡参加活动用户，即表示接受且自愿遵守平台规定，平台保留最终解释权；
					</p>
				</li>
				<li>
					<p>
						活动时间：北京时间2019年5月10日00：00分-2019年5月20日23：59分
					</p>
				</li>
			</ul>
		</div>
	</div>
	<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript" src="js/popup.js"></script>
	<script type="text/javascript">
		FastClick.attach(document.body);
		$('.openMask').on('click',function(){
		    $('.mask').css('display','block');
		});
		$('.closeMask').on('click',function(){
		    $('.mask').css('display','none');
		});

	    var hasLogin = false;
		//h5登录
		if (location.href.indexOf('type=h5') != -1) {
			if (location.href.indexOf('hasLogin=true') != -1) {
			  hasLogin = true;
			  queryTimes ();
			}else{
			  if ( parent && parent.closeIFrame ) {
			    parent.closeIFrame({action: 'goLogin'})
			  } else {
			    if ( location.search != '?goLogin') {
			      location.search = 'goLogin'
			    }
			  }
			}
		}

		//登录验证
		var init = function() {
		  if (window.android) {
		      hasLogin = android.isLogin();
		  }
		  if(hasLogin){
		      queryTimes ();
		  }
		}
		function isLogin(b) {
		  hasLogin = b
		  if(hasLogin){
		      queryTimes ();
		  }
		}
		function isiOS() {
           var u = navigator.userAgent;
           return !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
      	}

	    var remaining = 0;
		function queryTimes (){
			$.ajax({
			    url: "/luckyDraw/times",
			    jsonp: "callback",
			    // dataType: "jsonp",
			    async: true,
			    data: {},    //参数值
			    type: "GET",   //请求方式
			    beforeSend: function() {
			        //请求前的处理
			    },
			    success: function(req) {
			    	// console.log(req)
			    	if ( req.state ) {
			    		remaining = req.data
			    		$('.times').html(remaining);
			    	}
			    }
			});
		}

		window.onload = function(){
			init();//登录验证
		    var paomadeng = {
		        currentIndex : 1, //当前索引
		        indexCount : 16, //个数
		        timer : 0, //定时器
		        currentCycle : 0, //当前圈数
		        cycles : 4, //跑的圈数
		        speed : 300, //速度，即定时器的时间间隔
		        key : 0, //钥匙,随机数
		        btn : 0, //触发按钮
		        classPrefix : "pao-", //元素类名class前缀
		        obj : {
	        		'16': '感谢参与',
					'15': '588 U币',
					'14': 'NIKE手表',
					'13': '任天堂SWITCH',
					'12': '外星人17R4',
					'11': '18元红包',
					'10': 'Beats Solo3',
					'9': '100元手机话费',
					'8': '感谢参与',
					'7': '58元红包',
					'6': 'IPhone XS MAX',
					'5': '高级雷蛇套装',
					'4': '288 U币',
					'3': '秘密队服',
					'2': '至宝饰品',
					'1': '8元红包'
				},//奖品
		        reset : function(){
		        	if (!hasLogin) {
		                  // 还没登录则先登录
		                  if (location.href.indexOf('type=h5') != -1) {
		                    if ( parent && parent.closeIFrame ) {
		                      parent.closeIFrame({action: 'goLogin'})
		                    } else {
		                      if ( location.search != '?goLogin') {
		                        location.search = 'goLogin'
		                      }
		                    }
		                  } else {
		                    if (isiOS()) {
		                        goAppLogin();
		                    } else if (window.android){
		                        android.goAppLogin();
		                    }
		                  }
		                  return;
	              	}
		            if (remaining <= 0) {
						var popup = new Popup({
					        'type': 'submit',
					        'title': '提示信息',
					        'text': '剩余次数已经用完!'
					    })
		            	return
		            }
		            //触发对象
		            paomadeng.btn = this;
		            $('#startPao').addClass('unable');

		            clearInterval(paomadeng.timer);
		            paomadeng.currentCycle = 0;
		            paomadeng.speed = 400;
					// 用户抽奖操作
			        $.ajax({
					    url: "/luckyDraw/bet",
					    jsonp: "callback",
					    // dataType: "jsonp",
					    async: true,
					    data: {},    //参数值
					    type: "POST",   //请求方式
					    beforeSend: function() {
					        //请求前的处理
					    },
					    success: function(req) {
					    	// console.log(req)
					    	if ( req.state ) {
					    		remaining--;
					    		$('.times').html(remaining);
					    		paomadeng.key = req.data;
					    		return paomadeng.key;
					    	}else{
					    		if ( req.data == -1 ) {
					    			var popup = new Popup({
								        'type': 'submit',
								        'title': '提示信息',
								        'text': '剩余次数已经用完!'
								    })
					    		} else if ( req.data == -3 ) {
					    			var popup = new Popup({
								        'type': 'submit',
								        'title': '提示信息',
								        'text': '系统错误!'
								    })
					    		} else if ( req.data == 'ip' ) {
					    			var popup = new Popup({
								        'type': 'submit',
								        'title': '提示信息',
								        'text': '同一账户、同一IP无法重复领取!'
								    })
					    		} else {
					    			var popup = new Popup({
								        'type': 'submit',
								        'title': '提示信息',
								        'text': req.data
								    })
					    		}
					    		return;
					    	}
					    }
					});

		            paomadeng.run();
		        },
		        run : function(){
		            // console.log("speed:" + paomadeng.speed);

		            var before = paomadeng.currentIndex == 1 ? paomadeng.indexCount : paomadeng.currentIndex - 1;

		            //设置上一索引的类名
		            var beforeNode = document.getElementsByClassName(paomadeng.classPrefix + before)[0];
		            var beforeClassNewName = beforeNode.className.replace("on","");
		            beforeNode.className = beforeClassNewName;
		            //设置当前索引的类名
		            var currentNode = document.getElementsByClassName(paomadeng.classPrefix + paomadeng.currentIndex)[0];
		            currentNode.className += " on"; //注意前面有空格

		            paomadeng.upSpeed();
		            paomadeng.downSpeed();

		            paomadeng.currentIndex += 1;
		            paomadeng.currentIndex = paomadeng.currentIndex > paomadeng.indexCount ? 1: paomadeng.currentIndex;
		        },
		        //加速
		        upSpeed : function(){
		            //前2圈且speed>100时加速
		            if(paomadeng.currentCycle < 2 && paomadeng.speed > 100){
		                paomadeng.speed -= 5 * paomadeng.currentIndex ;
		                paomadeng.stop();
		                paomadeng.start();
		            }
		        },
		        //增加圈数 并 减速
		        downSpeed : function(){
		            //增加圈数
		            if(paomadeng.currentIndex == paomadeng.indexCount){
		                paomadeng.currentCycle += 1;
		            }

		            //如果当前所跑圈数小于总圈数-1 并且 速度小于400，那么减速
		            if(paomadeng.currentCycle > paomadeng.cycles-1 && paomadeng.speed < 400){
		                paomadeng.speed += 20;
		                paomadeng.stop();
		                paomadeng.start();
		            }

		            //如果当前所跑圈数大于总圈数 且 索引值等于key，那么停止奔跑
		            if(paomadeng.currentCycle > paomadeng.cycles && paomadeng.currentIndex == paomadeng.key){
		                paomadeng.stop();
		                paomadeng.showPrize();
		            }
		        },
		        stop : function(){
		            clearInterval(paomadeng.timer);
		        },
		        start : function(){
		            paomadeng.timer = setInterval(paomadeng.run , paomadeng.speed);
		        },
		        showPrize : function(){
		            //过一会再显示提示信息
		            setTimeout(function(){
		               if ( paomadeng.key == 8 || paomadeng.key == 16) {
		            		var popup = new Popup({
						        'type': 'submit',
						        'title': '提示信息',
						        'text': "很遗憾，您没有中奖,请再接再厉！",
						        'submitCallBack': function(){
						        	$('#startPao').removeClass('unable');
						        }
						    })
		            	}else{
			                var popup = new Popup({
						        'type': 'submit',
						        'title': '提示信息',
						        'text': "恭喜您，您抽中的是" + paomadeng.obj[paomadeng.key] + "!",
						        'submitCallBack': function(){
						        	$('#startPao').removeClass('unable');
						        }
						    })
			            }
		            },700);

		        }
		    };
		    document.getElementById("startPao").onclick= paomadeng.reset;
		};
	</script>
</body>
